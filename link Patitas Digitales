<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Registro de la página Patitas digitales</title>
    <!-- Tailwind CSS CDN -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- Inter font -->
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Inter', sans-serif;
            background-color: #f0f4f8; /* Light background */
        }
        /* Custom styles for better aesthetics */
        .card {
            background-color: #ffffff;
            border-radius: 1rem; /* Rounded corners */
            box-shadow: 0 10px 25px rgba(0, 0, 0, 0.1);
            padding: 2.5rem;
            max-width: 90%;
            margin: 2rem auto;
            text-align: center; /* Center content in card */
        }
        .input-field {
            border-radius: 0.5rem; /* Rounded input fields */
            border: 1px solid #cbd5e1; /* Light border */
            padding: 0.75rem 1rem;
            width: 100%;
            transition: border-color 0.2s;
        }
        .input-field:focus {
            outline: none;
            border-color: #3b82f6; /* Blue focus border */
            box-shadow: 0 0 0 3px rgba(59, 130, 246, 0.2);
        }
        .btn-primary {
            background-color: #3b82f6; /* Blue button */
            color: white;
            padding: 0.75rem 1.5rem;
            border-radius: 0.5rem;
            font-weight: 600;
            transition: background-color 0.2s, transform 0.1s;
        }
        .btn-primary:hover {
            background-color: #2563eb; /* Darker blue on hover */
            transform: translateY(-1px);
        }
        .image-preview {
            max-width: 100%;
            max-height: 200px;
            border-radius: 0.5rem;
            margin-top: 1rem;
            display: block; /* Ensures it takes up its own line */
            object-fit: contain; /* Ensures the image fits within the bounds without distortion */
        }
        .btn-secondary {
            background-color: #cbd5e1; /* Gray button */
            color: #4a5568;
            padding: 0.75rem 1.5rem;
            border-radius: 0.5rem;
            font-weight: 600;
            transition: background-color 0.2s, transform 0.1s;
            margin-top: 1rem;
            margin-left: 0.5rem; /* Space between buttons */
            margin-right: 0.5rem; /* Space between buttons */
        }
        .btn-secondary:hover {
            background-color: #a0aec0; /* Darker gray on hover */
            transform: translateY(-1px);
        }
        .btn-external-qr {
            background-color: #f97316; /* Orange button for external QR */
            color: white;
            padding: 0.75rem 1.5rem;
            border-radius: 0.5rem;
            font-weight: 600;
            transition: background-color 0.2s, transform 0.1s;
            margin-top: 1rem;
            margin-left: 0.5rem;
            margin-right: 0.5rem;
        }
        .btn-external-qr:hover {
            background-color: #ea580c; /* Darker orange on hover */
            transform: translateY(-1px);
        }
        .btn-copy {
            background-color: #34d399; /* Teal button for copy */
            color: white;
            padding: 0.75rem 1.5rem;
            border-radius: 0.5rem;
            font-weight: 600;
            transition: background-color 0.2s, transform 0.1s;
            margin-top: 1rem;
            margin-left: 0.5rem;
            margin-right: 0.5rem;
        }
        .btn-copy:hover {
            background-color: #0d9488; /* Darker teal on hover */
            transform: translateY(-1px);
        }
        .qr-link-container {
            border: 2px solid #e2e8f0;
            border-radius: 0.75rem;
            padding: 1.5rem;
            background-color: #f8fafc;
            margin: 2rem auto;
            word-break: break-all; /* Ensures long URLs wrap */
            text-align: left;
        }
        .qr-link-container a {
            color: #3b82f6; /* Blue link color */
            text-decoration: underline;
        }
        .qr-link-container a:hover {
            color: #2563eb; /* Darker blue on hover */
        }
    </style>
</head>
<body class="flex items-center justify-center min-h-screen p-4">
    <div class="card w-full md:w-3/4 lg:w-2/3 xl:w-1/2">
        <h1 class="text-3xl font-bold text-gray-800 mb-8 text-center">Registro de la página Patitas digitales</h1>

        <!-- Registration Form Section -->
        <div id="registrationFormSection">
            <form id="registrationForm" class="space-y-6" action="#" method="post">
                <div>
                    <label for="name" class="block text-sm font-medium text-gray-700 mb-1">Nombre Completo:</label>
                    <input type="text" id="name" name="name" class="input-field" placeholder="Ej: Juan Pérez" required>
                </div>
                <div>
                    <label for="email" class="block text-sm font-medium text-gray-700 mb-1">Correo Electrónico:</label>
                    <input type="email" id="email" name="email" class="input-field" placeholder="Ej: juan.perez@example.com" required>
                </div>
                <div>
                    <label for="phone" class="block text-sm font-medium text-gray-700 mb-1">Número de Teléfono:</label>
                    <input type="tel" id="phone" name="phone" class="input-field" placeholder="Ej: +56 9 1234 5678" required>
                </div>
                <!-- New section for pet diseases - moved here and made required -->
                <div>
                    <label for="petDiseases" class="block text-sm font-medium text-gray-700 mb-1">Enfermedades de tu mascota:</label>
                    <textarea id="petDiseases" name="petDiseases" rows="3" class="input-field" placeholder="Ej: Alergias, Diabetes, Problemas cardíacos..." required></textarea>
                </div>
                <div>
                    <label for="address" class="block text-sm font-medium text-gray-700 mb-1">Dirección (opcional):</label>
                    <input type="text" id="address" name="address" class="input-field" placeholder="Ej: Calle Falsa 123, Santiago">
                </div>
                <div>
                    <label for="imageFile" class="block text-sm font-medium text-gray-700 mb-1">Seleccionar Imagen (obligatorio):</label>
                    <input type="file" id="imageFile" name="imageFile" accept="image/*" class="input-field p-2" required>
                    <img id="imagePreview" class="image-preview hidden" src="#" alt="Vista previa de la imagen">
                </div>
                <div>
                    <label for="description" class="block text-sm font-medium text-gray-700 mb-1">Describe a tu mascota (opcional):</label>
                    <textarea id="description" name="description" rows="3" class="input-field" placeholder="Ej: Mi mascota es un golden retriever amigable y le encanta jugar a la pelota." maxlength="100"></textarea>
                </div>

                <button type="submit" class="btn-primary w-full">Generar Enlace QR</button>
            </form>
        </div>

        <!-- QR Link Display Section -->
        <div id="qrLinkDisplaySection" class="mt-8 pt-8 border-t border-gray-200 hidden">
            <h2 class="text-2xl font-semibold text-gray-800 mb-4 text-center">Enlace de tu Código QR:</h2>
            <div class="qr-link-container">
                <a id="qrGeneratedUrl" class="text-sm text-gray-700" href="#" target="_blank"></a>
            </div>
            <p class="text-center text-gray-600 text-sm mt-4">Copia este enlace o haz clic en "Ver QR Externo" para abrirlo.</p>
            <div class="flex justify-center mt-6">
                <button id="viewExternalQrBtn" class="btn-external-qr">Ver QR Externo</button>
                <button id="copyQrLinkBtn" class="btn-copy">Copiar Enlace</button>
                <button id="backToFormBtn" class="btn-secondary">Volver al Formulario</button>
            </div>
        </div>
    </div>

    <script>
        // Get references to the form and QR link display sections
        const registrationFormSection = document.getElementById('registrationFormSection');
        const qrLinkDisplaySection = document.getElementById('qrLinkDisplaySection');
        const registrationForm = document.getElementById('registrationForm');
        const backToFormBtn = document.getElementById('backToFormBtn');
        const viewExternalQrBtn = document.getElementById('viewExternalQrBtn'); // Button for external QR
        const copyQrLinkBtn = document.getElementById('copyQrLinkBtn'); // New copy button
        const qrGeneratedUrl = document.getElementById('qrGeneratedUrl'); // Element to display the URL
        const imagePreview = document.getElementById('imagePreview');
        const imageFile = document.getElementById('imageFile');

        // Event listener for file input change to display image preview
        imageFile.addEventListener('change', function(event) {
            const file = event.target.files[0];
            if (file) {
                const reader = new FileReader();
                reader.onload = function(e) {
                    imagePreview.src = e.target.result;
                    imagePreview.classList.remove('hidden'); // Show the image preview
                };
                reader.readAsDataURL(file); // Read file as Data URL for preview
            } else {
                imagePreview.src = '#';
                imagePreview.classList.add('hidden'); // Hide if no file selected
            }
        });

        // Event listener for form submission
        registrationForm.addEventListener('submit', function(event) {
            event.preventDefault(); // Prevent default form submission

            // Get form data
            const name = document.getElementById('name').value;
            const email = document.getElementById('email').value;
            const phone = document.getElementById('phone').value;
            const petDiseases = document.getElementById('petDiseases').value; // Get pet diseases value
            const address = document.getElementById('address').value;
            const description = document.getElementById('description').value;

            // Check if an image file is selected (now required)
            if (!imageFile.files || imageFile.files.length === 0) {
                alert('Por favor, selecciona una imagen para tu mascota.');
                return; // Stop form submission
            }

            // Construct data string for QR code (to be encoded for URL)
            let qrContent = `Nombre: ${name}`;

            if (email.trim()) {
                qrContent += `\nEmail: ${email}`;
            }
            if (phone.trim()) {
                qrContent += `\nTeléfono: ${phone}`;
            }
            // Pet diseases is now required, so always include it
            qrContent += `\nEnfermedades de mascota: ${petDiseases}`;

            if (address.trim()) {
                qrContent += `\nDirección: ${address}`;
            }
            if (description.trim()) {
                qrContent += `\nDescripción de mascota: ${description}`; // Changed label for QR content
            }


            // URL-encode the content for the QR code service
            const encodedQrContent = encodeURIComponent(qrContent);

            // Construct the URL for the external QR generation service
            const externalQrUrl = `https://api.qrserver.com/v1/create-qr-code/?size=256x256&data=${encodedQrContent}`;

            // Display the generated URL and set its href
            qrGeneratedUrl.textContent = externalQrUrl;
            qrGeneratedUrl.href = externalQrUrl; // Make the displayed text a clickable link

            // Set click handler for opening external QR URL
            viewExternalQrBtn.onclick = () => window.open(externalQrUrl, '_blank');

            // Hide the form section and show the QR link display section
            registrationFormSection.classList.add('hidden');
            qrLinkDisplaySection.classList.remove('hidden');
        });

        // Event listener for the "Volver al Formulario" button
        backToFormBtn.addEventListener('click', function() {
            // Hide the QR link display section and show the form section
            qrLinkDisplaySection.classList.add('hidden');
            registrationFormSection.classList.remove('hidden');
            // Optionally clear the form fields and image preview
            registrationForm.reset();
            imagePreview.src = '#';
            imagePreview.classList.add('hidden');
            qrGeneratedUrl.textContent = ''; // Clear the displayed URL
            qrGeneratedUrl.href = '#'; // Reset href
        });

        // Event listener for the "Copiar Enlace" button
        copyQrLinkBtn.addEventListener('click', function() {
            const textToCopy = qrGeneratedUrl.textContent;
            if (textToCopy) {
                // Use document.execCommand('copy') for better compatibility in iframes
                const textArea = document.createElement("textarea");
                textArea.value = textToCopy;
                document.body.appendChild(textArea);
                textArea.select();
                try {
                    document.execCommand('copy');
                    alert('Enlace copiado al portapapeles!');
                } catch (err) {
                    console.error('Error al copiar el texto: ', err);
                    alert('No se pudo copiar el enlace. Por favor, cópialo manualmente: ' + textToCopy);
                }
                document.body.removeChild(textArea);
            }
        });
    </script>
</body>
</html>
